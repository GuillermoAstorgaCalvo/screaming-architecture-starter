---
description: 'src/domains and cross-domain shared features: anatomy, state, i18n'
globs: ['**/*']
alwaysApply: false
---

## src/domains: Business Domains

See also: `architecture/folder-structure.mdc` (index linking adjacent rules)

Self-contained areas of business capability. Domain code stays isolated and imports only from `core` and `shared`.

### Domain Anatomy (example: `landing`)

**Current implementation:**

- `pages/*`: ✅ Route-level components; orchestrate domain hooks/services; minimal logic. Pages receive app-level context via props (e.g., `theme` via `withTheme` HOC). Example: `LandingPage.tsx` uses `useTranslation` hook for i18n.
- `components/*`: (Optional) Domain UI (sections/widgets); presentational when possible. Not yet implemented in landing domain.
- `hooks/*`: (Optional) Domain-specific hooks that compose `core` services (e.g., `useLandingStorage` would use `useStorage` and `useLogger`). Not yet implemented in landing domain.
- `i18n/*`: ✅ Domain translations. Contains translation files (`en.json`, `es.json`, `ar.json`) and registration file (`index.ts`) that uses `registerDomainTranslations()` from `@core/i18n/registry` with async IIFE pattern. Translations are registered in `app/main.tsx` via `import '@domains/<domain>/i18n';`. See `config/i18n.mdc` for registration pattern details.
- `store/*`: ✅ Zustand store(s); minimal state; derive when possible. Example: `landingStore.ts` with `useLandingStore` hook and `landingSelectors` for optimized state access. See `domains/<domain>/store/README.md` for best practices.

- `services/*`: ✅ Domain APIs/services; use `createApiService` from `@core/api/createApiService`; validate IO with Zod. Example: `services/api/getDemoContentService.ts` demonstrates type-safe API service creation with Zod validation.

**Optional/Planned:**

- `routes.ts`: Domain routes aggregation (lazy-loaded pages; no side effects) - for larger apps.
- `models/*`: Zod schemas + inferred TS types for runtime-safe domain models.
- `constants.ts`: Domain-specific constants/enums.

**Example Domain Structure (landing):**

```
src/domains/landing/
├── pages/
│   └── LandingPage.tsx        # ✅ Receives theme via props from withTheme HOC
│                              # Uses useTranslation hook for i18n
│                              # Minimal implementation demonstrating domain structure
├── services/                  # ✅ Domain API services
│   └── api/
│       └── getDemoContentService.ts  # ✅ Example API service using createApiService
├── i18n/                      # ✅ Domain translations
│   ├── index.ts               # ✅ Registration file using registerDomainTranslations() with async IIFE pattern
│   ├── en.json                # ✅ English translations
│   ├── es.json                # ✅ Spanish translations
│   └── ar.json                # ✅ Arabic translations (RTL)
└── store/                     # ✅ Zustand store for domain state
    ├── landingStore.ts        # ✅ Store implementation with useLandingStore hook and selectors
    └── README.md              # ✅ Store documentation and best practices
```

**Note**: The landing domain demonstrates the core domain structure with pages, services, i18n, and store. Optional directories (`components/`, `hooks/`, `models/`) can be added as the domain grows. See "Optional/Planned" section below for guidance on when to add these.

<｜tool▁calls▁begin｜><｜tool▁call▁begin｜>
read_file

### Shared Domains (cross-domain features)

`src/domains/shared/*` hosts reusable domains (auth, notifications, analytics) consumed by multiple domains.

Example structure:

```
src/domains/shared/
├── auth/
│   ├── pages/ (optional)
│   ├── components/
│   ├── hooks/
│   ├── services/
│   └── store/
├── notifications/
│   ├── components/ (Banner - Note: Alert and Toast moved to @core/ui)
│   ├── hooks/ (useNotifications, useToastQueue)
│   ├── models/ (notification.ts)
│   ├── store/ (notificationStore.ts)
│   └── services/ (notificationService.ts)
└── analytics/
    ├── hooks/ (useAnalytics)
    ├── models/ (analytics.ts)
    ├── services/ (analyticsService.ts)
    └── adapters/ (googleAnalyticsAdapter.ts, customAdapter.ts)
```

Guidance:

- Adapter-driven flows (e.g., Auth) via ports; avoid infra imports in domains.
- Shared features remain domain-agnostic and configurable via props/adapters.

## src/shared: Cross-cutting Composites and Helpers

Purpose: Reusable composites and helpers assembled from `core/ui` primitives. Domain-agnostic.

Structure:

```
src/shared/
├── components/
│   └── layout/
│       ├── Layout.tsx          # Main layout wrapper with Navbar
│       └── Navbar.tsx          # Navigation bar with optional theme toggle
├── hooks/ (optional: useMediaQuery, useEventListener, useClickOutside, ...)
└── utils/ (optional: formatCurrency, formatBytes, math, ...)
```

**Current Implementation:**

- `components/layout/Layout.tsx`: Main layout wrapper that accepts optional theme config and renders `Navbar` + children. Includes `SkipToContent` component from `@core/a11y/skipToContent` for accessibility. Accepts `theme` prop that gets passed to Navbar. Wraps content in `<main id="main-content">` for skip-to-content navigation.
- `components/layout/Navbar.tsx`: Navigation bar with home link and optional `ThemeToggle` when theme prop provided. Accepts theme configuration via props (not via context to maintain domain-agnostic design). Uses `ROUTES` constants from `@core/config/routes`. Uses `ThemeToggle` from `@core/ui/theme-toggle/ThemeToggle` (atomic UI primitive).

## src/domains/shared: Cross-Domain Shared Components

Purpose: Reusable composite components shared across multiple domains but not part of the core UI primitives.

**Current Implementation:**

- `components/autocomplete-combobox/`: ✅ Accessible combobox component built on core/ui primitives. Includes body/field/parts components, helpers, and hooks for state management, handlers, IDs, and setup.
- `components/date-picker/`: ✅ Date picker surface component with ISO parsing and validation.
- `components/slider/`: ✅ Slider widget component with model, view, helpers, and types.

Conventions:

- Naming: PascalCase for components, camelCase for hooks.
- Props: Export explicit `Props` types; prefer headless/composition patterns.
- Styling: Tailwind-first; pull from `core/constants/designTokens.ts`.
- A11y: Keyboard-navigable; provide aria escape hatches.
- i18n: Accept copy via props/children; no hard-coded strings.
- Testing: Integration-style tests under `tests/shared/*`.
- Imports: `shared` may import `core` and `core/ui`; must not import `app` or `infrastructure`.

Example `EmptyState` composite:

```tsx
// shared/components/data-display/EmptyState.tsx
import { Heading } from '@core/ui/Heading';
import { Text } from '@core/ui/Text';
import { Button } from '@core/ui/Button';

export type EmptyStateProps = {
	title: string;
	description?: string;
	actionLabel?: string;
	onAction?: () => void;
};

export default function EmptyState({ title, description, actionLabel, onAction }: EmptyStateProps) {
	return (
		<div className="flex flex-col items-center gap-3 py-10 text-center">
			<Heading level={3}>{title}</Heading>
			{description ? <Text className="text-muted-foreground">{description}</Text> : null}
			{actionLabel && onAction ? <Button onClick={onAction}>{actionLabel}</Button> : null}
		</div>
	);
}
```

## State Management per Domain

- Use Zustand per domain under `domains/<domain>/store/*`. Keep state minimal; derive when possible.
- Server-state via React Query in `app/providers/QueryProvider.tsx`.
- Avoid global singletons; if composing across domains is needed, add selector-only bridges.

## i18n per Domain

**Current Implementation:**

- ✅ Co-locate JSON per domain under `domains/<domain>/i18n/*` (e.g., `en.json`, `es.json`, `ar.json`).
- ✅ Registration file `domains/<domain>/i18n/index.ts` uses `registerDomainTranslations()` from `@core/i18n/registry` with async IIFE pattern (see `config/i18n.mdc` for details).
- ✅ Import registration in `app/main.tsx`: `import '@domains/<domain>/i18n';`
- ✅ Keep keys namespaced (e.g., `landing.hero.title`).
- ✅ Types remain in `core/i18n/types.ts` and are automatically type-safe via `useTranslation` hook.

### Cross-References

- Boundaries: `boundaries.mdc`
- State specifics: `architecture/state.mdc`
- i18n specifics: `config/i18n.mdc`
